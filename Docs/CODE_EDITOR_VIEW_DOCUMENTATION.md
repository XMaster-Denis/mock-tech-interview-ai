# CodeEditorView Documentation

## –û–±–∑–æ—Ä

[`CodeEditorView`](XInterview2/Presentation/Views/CodeEditorView.swift) - —ç—Ç–æ SwiftUI view, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞, –∏—Å–ø–æ–ª—å–∑—É—è –±–∏–±–ª–∏–æ—Ç–µ–∫—É CodeEditSourceEditor.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. CodeEditorCoordinator (—Å—Ç—Ä–æ–∫–∏ 9-47)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –º–µ–∂–¥—É –≤–Ω–µ—à–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö (binding) –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º.

**–ö–ª—é—á–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ—Ç**: CodeEditSourceEditor –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ binding `$code`. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.

**–°–≤–æ–π—Å—Ç–≤–∞**:
- `@Binding private var code: String` - Binding –∫ –≤–Ω–µ—à–Ω–µ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É –∫–æ–¥–∞
- `private weak var controller: TextViewController?` - –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
- `private var isApplyingExternalChange = false` - –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**–ú–µ—Ç–æ–¥—ã**:

##### `prepareCoordinator(controller: TextViewController)` (—Å—Ç—Ä–æ–∫–∏ 19-24)
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
- –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–µ—Ä–≤–∏—á–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `applyExternalChange(code)`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

##### `textViewDidChangeText(controller: TextViewController)` (—Å—Ç—Ä–æ–∫–∏ 26-29)
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∫–æ–¥ –≤—Ä—É—á–Ω—É—é
- –û–±–Ω–æ–≤–ª—è–µ—Ç –≤–Ω–µ—à–Ω–∏–π binding `$code` –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º
- **–í–∞–∂–Ω–æ**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `isApplyingExternalChange` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ü–∏–∫–ª–æ–≤

##### `applyExternalChange(_ newValue: String)` (—Å—Ç—Ä–æ–∫–∏ 31-46)
- **–ö–ª—é—á–µ–≤–æ–π –º–µ—Ç–æ–¥** –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –∏–∑–≤–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç GPT)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–µ–∫—Å—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª—Å—è
- –ó–∞–º–µ–Ω—è–µ—Ç –≤–µ—Å—å —Ç–µ–∫—Å—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —á–µ—Ä–µ–∑ `replaceCharacters(in:with:)`
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `needsDisplay` –∏ `layoutSubtreeIfNeeded()`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–ª–∞–≥ `isApplyingExternalChange` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ü–∏–∫–ª–æ–≤

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ**:
- –ë–µ–∑ —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç GPT –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –±—ã –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
- `SourceEditor` –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `$code` binding –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä—è–º–æ–µ –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `TextViewController` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI

#### 2. CodeEditorView (—Å—Ç—Ä–æ–∫–∏ 52-104)

**–°–≤–æ–π—Å—Ç–≤–∞**:
- `@Binding var code: String` - Binding –∫ –≤–Ω–µ—à–Ω–µ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É –∫–æ–¥–∞ (–∏–∑ InterviewViewModel)
- `let language: CodeLanguageInterview` - –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
- `let isEditable: Bool` - –§–ª–∞–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞

**State –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**:
- `@State private var editorState = SourceEditorState()` - –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ (–∫—É—Ä—Å–æ—Ä, –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∏ —Ç.–¥.)
- `@State private var theme: EditorTheme = .dark` - –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è (—Ç—ë–º–Ω–∞—è)
- `@State private var font = NSFont.monospacedSystemFont(ofSize: 12, weight: .regular)` - –®—Ä–∏—Ñ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
- `@State private var indentOption: IndentOption = .spaces(count: 4)` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—Å—Ç—É–ø–æ–≤
- `@State private var coordinator: CodeEditorCoordinator` - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä** (—Å—Ç—Ä–æ–∫–∏ 65-74):
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç binding –∫ –∫–æ–¥—É, —è–∑—ã–∫ –∏ —Ñ–ª–∞–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏
- –°–æ–∑–¥–∞—ë—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Å —Ç–µ–º –∂–µ binding –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**Body** (—Å—Ç—Ä–æ–∫–∏ 76-104):
- –°–æ–∑–¥–∞—ë—Ç `SourceEditor` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- –ü–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤ –º–∞—Å—Å–∏–≤ `coordinators`
- **–ö–ª—é—á–µ–≤–∞—è —á–∞—Å—Ç—å**: `.onChange(of: code)` –≤—ã–∑—ã–≤–∞–µ—Ç `coordinator.applyExternalChange(newValue)` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–¥–∞

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –û—Ç GPT –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É (–≤–Ω–µ—à–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

```
1. GPT –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥
   ‚Üì
2. ConversationManager.onCodeUpdate?(aicode)
   ‚Üì
3. InterviewViewModel.code = aicode (@Published —Å–≤–æ–π—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
   ‚Üì
4. MainView.viewModel.code (–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ)
   ‚Üì
5. CodeEditorView.$code (binding –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
   ‚Üì
6. .onChange(of: code) { _, newValue in
       coordinator.applyExternalChange(newValue)
   }
   ‚Üì
7. CodeEditorCoordinator.applyExternalChange(newValue)
   ‚Üì
8. controller.textView.replaceCharacters(in: full, with: newValue)
   ‚Üì
9. controller.textView.needsDisplay = true
   ‚Üì
10. –ö–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
```

### –û—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫ GPT (—Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∫–æ–¥ –≤ SourceEditor
   ‚Üì
2. SourceEditor –≤—ã–∑—ã–≤–∞–µ—Ç textViewDidChangeText(controller:)
   ‚Üì
3. CodeEditorCoordinator.textViewDidChangeText(controller:)
   ‚Üì
4. code = controller.text (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–π binding)
   ‚Üì
5. InterviewViewModel.code –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (@Published)
   ‚Üì
6. $code binding –≤ InterviewViewModel
   ‚Üì
7. conversationManager.updateCodeContext(code: newCode, language: ...)
   ‚Üì
8. ConversationManager.currentCodeContext –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   ‚Üì
9. GPT –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ–¥–∞
```

## –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```swift
func applyExternalChange(_ newValue: String) {
    guard let controller else { return }
    guard controller.text != newValue else { return }

    isApplyingExternalChange = true  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥

    // ... –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç ...

    isApplyingExternalChange = false  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥
}

func textViewDidChangeText(controller: TextViewController) {
    guard !isApplyingExternalChange else { return }  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥
    code = controller.text
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ**:
- –ë–µ–∑ —Ñ–ª–∞–≥–∞ `isApplyingExternalChange` –≤–æ–∑–Ω–∏–∫ –±—ã –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª:
  - –í–Ω–µ—à–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí `applyExternalChange` ‚Üí `replaceCharacters` ‚Üí `textViewDidChangeText` ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ binding ‚Üí `onChange` ‚Üí `applyExternalChange` ‚Üí ...
- –§–ª–∞–≥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç GPT –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 2. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI

```swift
controller.textView.replaceCharacters(in: full, with: newValue)
controller.textView.needsDisplay = true
controller.textView.layoutSubtreeIfNeeded()
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ**:
- `replaceCharacters` –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—É—é –º–æ–¥–µ–ª—å
- `needsDisplay = true` –ø–æ–º–µ—á–∞–µ—Ç view –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
- `layoutSubtreeIfNeeded()` –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç layout
- –ë–µ–∑ —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

```swift
guard controller.text != newValue else { return }
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ**:
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –£–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò–∑–±–µ–≥–∞–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏—è UI

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SourceEditor

### Appearance (—Å—Ç—Ä–æ–∫–∏ 81-85)
- `theme: .dark` - –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤ `EditorTheme+Default.swift`)
- `font: NSFont.monospacedSystemFont(ofSize: 12, weight: .regular)` - –ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç 12pt
- `wrapLines: true` - –ü–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ –≤–∫–ª—é—á—ë–Ω

### Behavior (—Å—Ç—Ä–æ–∫–∏ 86-89)
- `isEditable: isEditable` - –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- `indentOption: .spaces(count: 4)` - –û—Ç—Å—Ç—É–ø—ã 4 –ø—Ä–æ–±–µ–ª–∞

### Peripherals (—Å—Ç—Ä–æ–∫–∏ 90-96)
- `showGutter: true` - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫
- `showMinimap: false` - –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–∏–Ω–∏-–∫–∞—Ä—Ç—É
- `showReformattingGuide: false` - –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `invisibleCharactersConfiguration: .empty` - –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ–≤–∏–¥–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
- `warningCharacters: []` - –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ —Å–∏–º–≤–æ–ª–∞—Ö

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Swift Packages
- `CodeEditSourceEditor` - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
- `CodeEditLanguages` - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- `CodeEditTextView` - –¢–µ–∫—Å—Ç–æ–≤—ã–π view

### –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
- [`EditorTheme+Default.swift`](XInterview2/Presentation/Extensions/EditorTheme+Default.swift) - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å —Ç–µ–º–∞–º–∏ light/dark
- [`CodeLanguageInterview.swift`](XInterview2/Domain/Models/CodeLanguageInterview.swift) - –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –±—É–¥—É—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
1. –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ (–æ—Ç GPT –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç)
2. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø—Ä–∏ –≤–Ω–µ—à–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
4. –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. **–ù–ï –∏–∑–º–µ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞** - –æ–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
2. **–ù–ï —É–¥–∞–ª—è—Ç—å `.onChange(of: code)`** - —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±–Ω–æ–≤–ª—è—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏–∑–≤–Ω–µ
3. **–ù–ï –∏–∑–º–µ–Ω—è—Ç—å —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞** - binding –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä

### üîß –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–µ–º (light/dark) —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
3. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫—É—Ä—Å–æ—Ä–æ–≤/–≤—ã–¥–µ–ª–µ–Ω–∏–π
4. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∏—Å–∫ –∏ –∑–∞–º–µ–Ω—É
5. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–Ω–∏–ø–ø–µ—Ç–æ–≤ –∫–æ–¥–∞

### üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- –ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç

### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

#### –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
1. –í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
2. –ü—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç GPT –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ü–∏–∫–ª–æ–≤

#### –ü—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ –ø—Ä–æ–±–ª–µ–º —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `coordinator.applyExternalChange(newValue)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `.onChange`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `isApplyingExternalChange` —Ñ–ª–∞–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `applyExternalChange` –∏ `textViewDidChangeText`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `needsDisplay` –∏ `layoutSubtreeIfNeeded()` –≤—ã–∑—ã–≤–∞—é—Ç—Å—è

#### –ü—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@Binding var code: String` –¥–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏
2. –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–ø–∏–∏ –∫–æ–¥–∞ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ binding –Ω–∞–ø—Ä—è–º—É—é
3. –û–±–Ω–æ–≤–ª—è–π—Ç–µ –∫–æ–¥ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `InterviewViewModel.code` –∏–ª–∏ `ConversationManager.updateCodeContext`

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–≤ MainView)
```swift
CodeEditorView(
    code: $viewModel.code,
    language: .swift,
    isEditable: true
)
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –æ—Ç GPT (–≤ ConversationManager)
```swift
if let aicode = aiResponse.aicode, !aicode.isEmpty {
    onCodeUpdate?(aicode)  // –í—ã–∑—ã–≤–∞–µ—Ç callback, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç InterviewViewModel.code
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ (–≤ InterviewViewModel)
```swift
func setCode(_ newCode: String) {
    code = newCode  // @Published —Å–≤–æ–π—Å—Ç–≤–æ –æ–±–Ω–æ–≤–∏—Ç binding –∏ –≤—ã–∑–æ–≤–µ—Ç .onChange –≤ CodeEditorView
    conversationManager.updateCodeContext(code: newCode, language: codeLanguage)
}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

[`CodeEditorView`](XInterview2/Presentation/Views/CodeEditorView.swift) - —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞. –ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `CodeEditorCoordinator` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–Ω–µ—à–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º CodeEditSourceEditor.

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ**: –ù–ï –∏–∑–º–µ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞ –∏ –º–µ—Ö–∞–Ω–∏–∑–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ –≤—ã –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–Ω–∏–º–∞–µ—Ç–µ, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç. –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.
